<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>CNC Simulator Pro</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta
			name="description"
			content="Professional 3-axis CNC G-code simulator"
		/>
		<meta name="theme-color" content="#ffffff" />

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>
		<script>
			tailwind.config = {
				darkMode: 'class',
				theme: {
					extend: {
						colors: {
							primary: '#2563eb', // Modern Blue
							secondary: '#475569',
							surface: '#F8FAFC',
							'surface-dark': '#0f172a',
						},
						fontFamily: {
							sans: ['Inter', 'system-ui', 'sans-serif'],
							mono: ['JetBrains Mono', 'Menlo', 'monospace'],
						},
						boxShadow: {
							soft: '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
							card: '0 0 0 1px rgba(0,0,0,0.03), 0 2px 8px rgba(0,0,0,0.04)',
						},
					},
				},
			};
		</script>

		<!-- Google Fonts -->
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
			rel="stylesheet"
		/>

		<!-- Icons -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		/>

		<!-- Custom Styles -->
		<link href="styles/custom.css" rel="stylesheet" />

		<!-- Libraries -->
		<script src="lib/gl-matrix-2.2.0-min.js"></script>
		<script src="lib/webgl-utils.js"></script>
		<script src="js/parseGcode.js"></script>
		<script src="js/RenderPath.js"></script>
		<script src="js/ui.js"></script>

		<style>
			body {
				font-family: 'Inter', sans-serif;
			}
			.font-mono {
				font-family: 'JetBrains Mono', monospace;
			}
		</style>
		<style>
			#timeSlider {
				height: 0.5rem;
			}
			#timeSlider::-webkit-slider-runnable-track {
				height: 0.25rem;
				background: #e5e7eb;
				border-radius: 9999px;
			}
			#timeSlider::-webkit-slider-thumb {
				-webkit-appearance: none;
				appearance: none;
				margin-top: -6px;
				height: 16px;
				width: 16px;
				background: #046288;
				border-radius: 9999px;
				border: none;
			}
			#timeSlider::-moz-range-track {
				height: 0.25rem;
				background: #e5e7eb;
				border-radius: 9999px;
			}
			#timeSlider::-moz-range-thumb {
				height: 16px;
				width: 16px;
				background: #046288;
				border: none;
				border-radius: 9999px;
			}
		</style>

		<script>
			// Theme Logic
			function initTheme() {
				const saved = localStorage.getItem('theme');
				const isDark = saved === 'dark';
				if (isDark) document.documentElement.classList.add('dark');
			}
			function toggleTheme() {
				const isDark = document.documentElement.classList.contains('dark');
				document.documentElement.classList.toggle('dark', !isDark);
				localStorage.setItem('theme', !isDark ? 'dark' : 'light');
			}

			// Simulator Logic (Preserved)
			let renderPath;
			function simulator_init() {
				initTheme();
				renderPath = startRenderPath(
					{},
					document.querySelector('#renderPathCanvas'),
					null,
					'js',
					simulate
				);
				const savedToolpath = localStorage.getItem('colorToolpathHex');
				const savedStockTop = localStorage.getItem('colorStockTopHex');
				const savedStockBottom = localStorage.getItem('colorStockBottomHex');
				const savedBackground = localStorage.getItem('colorBackgroundHex');
				if (
					savedToolpath &&
					savedStockTop &&
					savedStockBottom &&
					savedBackground
				) {
					document.getElementById('colorToolpath').value = savedToolpath;
					document.getElementById('colorToolpathHex').value = savedToolpath;
					document.getElementById('colorStockTop').value = savedStockTop;
					document.getElementById('colorStockTopHex').value = savedStockTop;
					document.getElementById('colorStockBottom').value = savedStockBottom;
					document.getElementById('colorStockBottomHex').value =
						savedStockBottom;
					document.getElementById('colorBackground').value = savedBackground;
					document.getElementById('colorBackgroundHex').value = savedBackground;
					updateCanvasColors();
				} else {
					resetCanvasColors();
				}
			}

			function simulate(rp) {
				if (
					rp &&
					(!renderPath || typeof renderPath.fillPathBuffer !== 'function')
				)
					renderPath = rp;
				if (!renderPath || typeof renderPath.fillPathBuffer !== 'function')
					return;

				var canvas = document.getElementById('renderPathCanvas');
				// Ensure canvas fills container
				const container = canvas.parentElement;
				canvas.width = container.offsetWidth;
				canvas.height = container.offsetHeight;

				renderPath.fillPathBuffer(
					jscut.parseGcode(
						{},
						document.querySelector('textarea#gcodeText').value
					),
					document.querySelector('input#surfaceZ').value,
					document.querySelector('input#cutterDia').value,
					document.querySelector('input#cutterAngle').value,
					document.querySelector('input#cutterHeight').value
				);
				set_time();
			}
			window.addEventListener('resize', () => {
				// Debounce resize
				clearTimeout(window.resizeTimer);
				window.resizeTimer = setTimeout(simulate, 100);
			});

			function set_time() {
				timeSliderElement = document.querySelector('#timeSlider');
				if (!renderPath) return;

				renderPath.setStopAtTime(
					(timeSliderElement.value / timeSliderElement.getAttribute('max')) *
						renderPath.totalTime
				);

				// Update Time Display
				const timeVal = Math.round(
					(timeSliderElement.value / timeSliderElement.getAttribute('max')) *
						renderPath.totalTime
				);
				document.getElementById('timeDisplay').innerText = timeVal + 's';

				// Update Coords
				if (renderPath.X !== undefined) {
					document.getElementById('coordX').innerText = renderPath.X.toFixed(2);
					document.getElementById('coordY').innerText = renderPath.Y.toFixed(2);
					document.getElementById('coordZ').innerText = renderPath.Z.toFixed(2);
				}
			}

			function loadfile() {
				var reader = new FileReader();
				reader.onload = function (e) {
					document.getElementById('gcodeText').value = e.target.result;
					simulate();
					config_changed();
				};
				reader.readAsText(document.getElementById('myFile').files[0]);
			}

			var anim;
			function animate_next() {
				slider = document.getElementById('timeSlider');
				slider.value = Number(slider.value) + 30;
				if (slider.value >= 10000) slider.value = 0;
				slider.dispatchEvent(new Event('change'));
				set_time(); // Ensure UI updates
			}
			function animatec() {
				const btn = document.getElementById('animateBtn');
				if (!anim) {
					anim = setInterval(animate_next, 100);
					// Active State (Pause) - Subtle Premium Look
					btn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
					btn.classList.add(
						'bg-blue-50',
						'text-primary',
						'border',
						'border-blue-200',
						'dark:bg-blue-900/30',
						'dark:border-blue-800',
						'dark:text-blue-300'
					);
					btn.classList.remove(
						'text-gray-600',
						'dark:text-gray-300',
						'hover:text-gray-900',
						'dark:hover:text-white'
					);
				} else {
					clearInterval(anim);
					anim = undefined;
					// Inactive State (Animate)
					btn.innerHTML = '<i class="fas fa-film mr-2"></i>Animate';
					btn.classList.remove(
						'bg-blue-50',
						'text-primary',
						'border',
						'border-blue-200',
						'dark:bg-blue-900/30',
						'dark:border-blue-800',
						'dark:text-blue-300'
					);
					btn.classList.add(
						'text-gray-600',
						'dark:text-gray-300',
						'hover:text-gray-900',
						'dark:hover:text-white'
					);
				}
				config_changed();
			}

			const hashParams = new URLSearchParams(window.location.hash.substring(1));
			function config_changed(gcode = false) {
				hashParams.set('bd', document.querySelector('input#cutterDia').value);
				hashParams.set('ba', document.querySelector('input#cutterAngle').value);
				hashParams.set(
					'bh',
					document.querySelector('input#cutterHeight').value
				);
				hashParams.set('sz', document.querySelector('input#surfaceZ').value);
				hashParams.set('an', Number(!!anim));
				hashParams.delete('gcode');
				window.location.hash = hashParams.toString();

				if (gcode) {
					try {
						hashParams.delete('gurl');
						window.location.hash =
							hashParams.toString() +
							'&gcode=' +
							encodeURIComponent(
								document.querySelector('textarea#gcodeText').value
							);
					} catch {
						alert('G-Code is too long for URL!');
					}
				}
			}

			function parse_url() {
				if (hashParams.get('bd'))
					document.querySelector('input#cutterDia').value =
						hashParams.get('bd');
				if (hashParams.get('ba'))
					document.querySelector('input#cutterAngle').value =
						hashParams.get('ba');
				if (hashParams.get('bh'))
					document.querySelector('input#cutterHeight').value =
						hashParams.get('bh');
				if (hashParams.get('sz'))
					document.querySelector('input#surfaceZ').value = hashParams.get('sz');
				if (hashParams.get('gcode'))
					document.querySelector('textarea#gcodeText').value =
						hashParams.get('gcode');
				if (hashParams.get('gurl')) {
					fetch(hashParams.get('gurl'))
						.then(response => response.text())
						.then(text => {
							document.querySelector('textarea#gcodeText').value =
								';DOWNLOADED FROM: ' + hashParams.get('gurl') + '\n' + text;
							simulate();
						});
				}
				if (hashParams.get('an') && hashParams.get('an') == Number(!anim))
					animatec();
			}

			// Canvas Color Management
			function hexToRgb(hex) {
				const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
				return result
					? {
							r: parseInt(result[1], 16) / 255,
							g: parseInt(result[2], 16) / 255,
							b: parseInt(result[3], 16) / 255,
					  }
					: null;
			}

			function syncColorFromHex(colorInputId, hexValue) {
				const colorInput = document.getElementById(colorInputId);
				if (colorInput && /^#[0-9A-F]{6}$/i.test(hexValue)) {
					colorInput.value = hexValue;
				}
			}

			function updateCanvasColors() {
				const toolpathColor = hexToRgb(
					document.getElementById('colorToolpath').value
				);
				const stockTopColor = hexToRgb(
					document.getElementById('colorStockTop').value
				);
				const stockBottomColor = hexToRgb(
					document.getElementById('colorStockBottom').value
				);
				const bgColor = hexToRgb(
					document.getElementById('colorBackground').value
				);

				if (!renderPath || !renderPath.updateColors) {
					return;
				}

				renderPath.updateColors(
					toolpathColor,
					stockTopColor,
					stockBottomColor,
					bgColor
				);

				document.getElementById('colorToolpathHex').value =
					document.getElementById('colorToolpath').value;
				document.getElementById('colorStockTopHex').value =
					document.getElementById('colorStockTop').value;
				document.getElementById('colorStockBottomHex').value =
					document.getElementById('colorStockBottom').value;
				document.getElementById('colorBackgroundHex').value =
					document.getElementById('colorBackground').value;

				const container = document.getElementById('canvasContainer');
				if (container)
					container.style.backgroundColor =
						document.getElementById('colorBackground').value;
			}

			function saveCanvasColors() {
				localStorage.setItem(
					'colorToolpathHex',
					document.getElementById('colorToolpath').value
				);
				localStorage.setItem(
					'colorStockTopHex',
					document.getElementById('colorStockTop').value
				);
				localStorage.setItem(
					'colorStockBottomHex',
					document.getElementById('colorStockBottom').value
				);
				localStorage.setItem(
					'colorBackgroundHex',
					document.getElementById('colorBackground').value
				);
			}

			function resetCanvasColors() {
				document.getElementById('colorToolpath').value = '#00e5e5';
				document.getElementById('colorStockTop').value = '#e6e6eb';
				document.getElementById('colorStockBottom').value = '#33404d';
				document.getElementById('colorBackground').value = '#f8f9fc';
				updateCanvasColors();
			}
		</script>
	</head>
	<body
		class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 h-screen flex flex-col overflow-hidden transition-colors duration-200"
		onload="simulator_init(); parse_url(); simulate();"
	>
		<!-- 1. Header Bar -->
		<header
			class="h-[70px] bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-6 shadow-sm z-20 flex-shrink-0"
		>
			<div class="flex items-center gap-6">
				<div class="flex items-center gap-3">
					<div
						class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center text-white font-bold"
					>
						<i class="fas fa-layer-group"></i>
					</div>
					<h1
						class="text-lg font-semibold tracking-tight text-gray-900 dark:text-white"
					>
						CNC Simulator Pro
					</h1>
				</div>

				<div class="h-6 w-px bg-gray-200 dark:bg-gray-700 mx-2"></div>

				<div class="flex items-center gap-2">
					<button
						onclick="document.getElementById('myFile').click()"
						class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md transition-colors"
					>
						<i class="fas fa-folder-open text-primary"></i> Import
					</button>
					<input
						id="myFile"
						type="file"
						accept=".gcode,.nc,.ngc,.txt,.g-code,.cnc"
						onchange="loadfile();"
						class="hidden"
					/>

					<button
						onclick="config_changed(true)"
						class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md transition-colors"
					>
						<i class="fas fa-share-alt text-green-500"></i> Share
					</button>
				</div>
			</div>

			<div class="flex items-center gap-4">
				<div
					class="flex items-center bg-gray-100 dark:bg-gray-700 rounded-full p-1"
				>
					<button
						onclick="simulate()"
						class="px-4 py-1.5 text-sm font-medium bg-white dark:bg-gray-600 text-primary dark:text-white shadow-sm rounded-full hover:shadow transition-all"
					>
						<i class="fas fa-play mr-1"></i> Simulate
					</button>
					<button
						id="animateBtn"
						onclick="animatec()"
						class="px-4 py-1.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors"
					>
						<i class="fas fa-film mr-1"></i> Animate
					</button>
				</div>

				<button
					onclick="toggleTheme()"
					class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 transition-colors"
				>
					<i class="fas fa-moon dark:hidden"></i>
					<i class="fas fa-sun hidden dark:block"></i>
				</button>
			</div>
		</header>

		<!-- Main Layout -->
		<div class="flex-1 flex overflow-hidden">
			<!-- 2. Left Sidebar -->
			<aside
				class="w-[70px] bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col items-center py-4 gap-4 z-10 flex-shrink-0"
			>
				<a
					href="#"
					class="sidebar-nav-item w-10 h-10 flex items-center justify-center rounded-xl text-primary bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400 transition-colors"
					title="Dashboard"
				>
					<i class="fas fa-home text-lg"></i>
				</a>
				<a
					href="#"
					class="sidebar-nav-item w-10 h-10 flex items-center justify-center rounded-xl text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
					title="Tools"
				>
					<i class="fas fa-tools text-lg"></i>
				</a>
				<a
					href="#"
					class="sidebar-nav-item w-10 h-10 flex items-center justify-center rounded-xl text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
					title="Dimensions"
				>
					<i class="fas fa-ruler-combined text-lg"></i>
				</a>
				<a
					href="#"
					class="sidebar-nav-item w-10 h-10 flex items-center justify-center rounded-xl text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
					title="Camera"
				>
					<i class="fas fa-video text-lg"></i>
				</a>
				<div class="flex-1"></div>
				<a
					href="#"
					class="sidebar-nav-item w-10 h-10 flex items-center justify-center rounded-xl text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
					title="Help"
				>
					<i class="fas fa-question-circle text-lg"></i>
				</a>
			</aside>

			<!-- 3. Center Simulation Canvas -->
			<main
				class="flex-1 bg-gray-50 dark:bg-gray-900 p-4 relative flex flex-col min-w-0"
			>
				<div
					id="canvasContainer"
					class="flex-1 bg-white dark:bg-gray-800 rounded-2xl shadow-soft border border-gray-200 dark:border-gray-700 relative overflow-hidden flex flex-col"
				>
					<!-- Canvas Container -->
					<div class="flex-1 relative w-full h-full">
						<canvas
							id="renderPathCanvas"
							class="block w-full h-full outline-none"
						></canvas>

						<!-- Floating Controls -->
						<div class="absolute top-4 right-4 flex flex-col gap-2">
							<button
								class="w-8 h-8 bg-white dark:bg-gray-700 rounded-lg shadow-sm border border-gray-200 dark:border-gray-600 flex items-center justify-center text-gray-500 hover:text-primary transition-colors"
								title="Toggle Grid"
							>
								<i class="fas fa-border-all"></i>
							</button>
							<button
								class="w-8 h-8 bg-white dark:bg-gray-700 rounded-lg shadow-sm border border-gray-200 dark:border-gray-600 flex items-center justify-center text-gray-500 hover:text-primary transition-colors"
								title="Reset View"
							>
								<i class="fas fa-sync-alt"></i>
							</button>
						</div>

						<!-- Top Left Coordinates Stack -->
						<div
							class="absolute top-4 left-4 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm border border-gray-200 dark:border-gray-700 px-3 py-2 rounded-lg shadow-sm text-xs font-mono font-medium text-gray-600 dark:text-gray-300 space-y-1"
						>
							<div class="flex items-center gap-2">
								<span class="text-red-500 w-4">X:</span>
								<span id="coordX" class="text-gray-800 dark:text-gray-100"
									>0.00</span
								>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-green-500 w-4">Y:</span>
								<span id="coordY" class="text-gray-800 dark:text-gray-100"
									>0.00</span
								>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-blue-500 w-4">Z:</span>
								<span id="coordZ" class="text-gray-800 dark:text-gray-100"
									>0.00</span
								>
							</div>
						</div>
					</div>

					<!-- Timeline Slider -->
					<div
						class="h-12 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 flex items-center gap-4"
					>
						<button
							onclick="simulate()"
							class="text-gray-400 hover:text-primary"
						>
							<i class="fas fa-redo"></i>
						</button>
						<input
							type="range"
							min="0"
							max="10000"
							value="10000"
							id="timeSlider"
							class="w-full flex-1 h-2 rounded-lg cursor-pointer accent-primary"
							onchange="set_time()"
							oninput="set_time()"
						/>
						<span
							id="timeDisplay"
							class="text-xs font-mono text-gray-500 w-12 text-right"
							>0s</span
						>
					</div>
				</div>
			</main>

			<!-- 4. Right Panel -->
			<aside
				class="w-[350px] bg-white dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 flex flex-col z-10 flex-shrink-0"
			>
				<!-- Tabs Header -->
				<div
					class="flex items-center border-b border-gray-200 dark:border-gray-700 px-2 pt-2"
				>
					<button
						data-tab-target="#tab-params"
						class="flex-1 pb-2 text-sm font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 border-b-2 border-transparent transition-colors"
					>
						Params
					</button>
					<button
						data-tab-target="#tab-tool"
						class="flex-1 pb-2 text-sm font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 border-b-2 border-transparent transition-colors"
					>
						Tool
					</button>

					<button
						data-tab-target="#tab-gcode"
						class="flex-1 pb-2 text-sm font-medium text-primary border-b-2 border-primary bg-blue-50 dark:bg-blue-900/20 rounded-t-lg transition-colors"
					>
						Code
					</button>
				</div>

				<!-- Tab Content -->
				<div class="flex-1 overflow-y-auto p-4 custom-scrollbar">
					<!-- Parameters Tab -->
					<div id="tab-params" data-tab-content class="hidden space-y-4">
						<div
							class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 border border-gray-100 dark:border-gray-700"
						>
							<h3
								class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3"
							>
								Dimensions
							</h3>
							<div class="space-y-3">
								<div>
									<label
										class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"
										>Surface Z</label
									>
									<div class="relative">
										<span
											class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
											><i class="fas fa-arrows-alt-v"></i
										></span>
										<input
											id="surfaceZ"
											type="number"
											value="0"
											onchange="config_changed()"
											class="w-full pl-9 pr-3 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
										/>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Tool Tab -->
					<div id="tab-tool" data-tab-content class="hidden space-y-4">
						<div
							class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 border border-gray-100 dark:border-gray-700"
						>
							<h3
								class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3"
							>
								Bit Configuration
							</h3>
							<div class="grid grid-cols-2 gap-3">
								<div class="col-span-2">
									<label
										class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"
										>Diameter (mm)</label
									>
									<div class="relative">
										<span
											class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
											><i class="fas fa-circle-notch"></i
										></span>
										<input
											id="cutterDia"
											type="number"
											value="3.175"
											onchange="config_changed()"
											class="w-full pl-9 pr-3 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
										/>
									</div>
								</div>
								<div>
									<label
										class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"
										>Angle (Â°)</label
									>
									<input
										id="cutterAngle"
										type="number"
										value="180"
										onchange="config_changed()"
										class="w-full px-3 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
									/>
								</div>
								<div>
									<label
										class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"
										>Height (mm)</label
									>
									<input
										id="cutterHeight"
										type="number"
										value="50"
										onchange="config_changed()"
										class="w-full px-3 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
									/>
								</div>
							</div>
						</div>

						<!-- Canvas Color Controls -->
						<div
							class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 border border-gray-100 dark:border-gray-700"
						>
							<h3
								class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3"
							>
								Canvas Colors
							</h3>
							<div class="space-y-3">
								<div>
									<label
										class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"
										>Toolpath Color</label
									>
									<div class="flex gap-2">
										<input
											id="colorToolpath"
											type="color"
											value="#00e5e5"
											onchange="updateCanvasColors()"
											class="w-12 h-8 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"
										/>
										<input
											type="text"
											id="colorToolpathHex"
											value="#00e5e5"
											onchange="syncColorFromHex('colorToolpath', this.value); updateCanvasColors()"
											class="flex-1 px-2 py-1 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-xs font-mono"
										/>
									</div>
								</div>
								<div>
									<label
										class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"
										>Stock Top</label
									>
									<div class="flex gap-2">
										<input
											id="colorStockTop"
											type="color"
											value="#e6e6eb"
											onchange="updateCanvasColors()"
											class="w-12 h-8 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"
										/>
										<input
											type="text"
											id="colorStockTopHex"
											value="#e6e6eb"
											onchange="syncColorFromHex('colorStockTop', this.value); updateCanvasColors()"
											class="flex-1 px-2 py-1 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-xs font-mono"
										/>
									</div>
								</div>
								<div>
									<label
										class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"
										>Stock Bottom</label
									>
									<div class="flex gap-2">
										<input
											id="colorStockBottom"
											type="color"
											value="#33404d"
											onchange="updateCanvasColors()"
											class="w-12 h-8 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"
										/>
										<input
											type="text"
											id="colorStockBottomHex"
											value="#33404d"
											onchange="syncColorFromHex('colorStockBottom', this.value); updateCanvasColors()"
											class="flex-1 px-2 py-1 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-xs font-mono"
										/>
									</div>
								</div>
								<div>
									<label
										class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"
										>Background</label
									>
									<div class="flex gap-2">
										<input
											id="colorBackground"
											type="color"
											value="#f8f9fc"
											onchange="updateCanvasColors()"
											class="w-12 h-8 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"
										/>
										<input
											type="text"
											id="colorBackgroundHex"
											value="#f8f9fc"
											onchange="syncColorFromHex('colorBackground', this.value); updateCanvasColors()"
											class="flex-1 px-2 py-1 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-xs font-mono"
										/>
									</div>
								</div>
								<div class="grid grid-cols-2 gap-2">
									<button
										onclick="resetCanvasColors()"
										class="px-3 py-2 text-xs bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors"
									>
										Reset
									</button>
									<button
										onclick="saveCanvasColors()"
										class="px-3 py-2 text-xs bg-primary text-white rounded-lg hover:bg-[#035173] transition-colors"
									>
										Save
									</button>
								</div>
							</div>
						</div>
					</div>

					<!-- G-code Tab -->
					<div id="tab-gcode" data-tab-content class="h-full flex flex-col">
						<div class="flex-1 relative">
							<textarea
								id="gcodeText"
								class="w-full h-full resize-none bg-gray-900 text-gray-100 font-mono text-xs p-4 rounded-xl focus:outline-none border border-gray-700 leading-relaxed"
								spellcheck="false"
							>
G0 X0 Y0 Z3
G1 Z0 F40
G2 X10 Y10 I5 J5 Z-3
G0 Z3</textarea
							>
							<div class="absolute bottom-4 right-4 flex gap-2">
								<button
									onclick="document.getElementById('gcodeText').value = ''"
									class="p-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg text-xs shadow-sm border border-gray-600"
									title="Clear"
								>
									<i class="fas fa-trash"></i>
								</button>
							</div>
						</div>
						<div class="mt-4">
							<button
								onclick="simulate()"
								class="w-full py-2.5 bg-primary hover:bg-blue-600 text-white font-medium rounded-xl shadow-lg shadow-blue-500/30 transition-all flex items-center justify-center gap-2"
							>
								<i class="fas fa-play"></i> Run Simulation
							</button>
						</div>
					</div>
				</div>
			</aside>
		</div>
	</body>
</html>
